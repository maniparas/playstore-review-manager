{% extends "base.html" %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-4">
    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h5 class="card-title">Filters</h5>
        <form id="filters-form" class="mt-3">
          <div class="mb-3">
            <label class="form-label">Package name</label>
            <input type="text" class="form-control" name="package_name" value="{{ defaults.package_name }}" placeholder="com.example.app" required />
          </div>
          <div class="row g-2">
            <div class="col-6">
              <label class="form-label">Start date</label>
              <input type="datetime-local" class="form-control" name="start_date" />
            </div>
            <div class="col-6">
              <label class="form-label">End date</label>
              <input type="datetime-local" class="form-control" name="end_date" />
            </div>
          </div>
          <div class="row g-2 mt-2">
            <div class="col-6">
              <label class="form-label">Min rating</label>
              <select name="min_rating" class="form-select">
                <option value="">Any</option>
                {% for rating in range(1,6) %}
                <option value="{{ rating }}">{{ rating }}★</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-6">
              <label class="form-label">Max rating</label>
              <select name="max_rating" class="form-select">
                <option value="">Any</option>
                {% for rating in range(1,6) %}
                <option value="{{ rating }}">{{ rating }}★</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="mt-3">
            <label class="form-label">Translation language</label>
            <input type="text" class="form-control" name="translation_language" value="{{ defaults.translation_language }}" placeholder="en" />
          </div>
          <div class="row g-2 mt-2">
            <div class="col-6">
              <label class="form-label">Page size</label>
              <input type="number" class="form-control" name="page_size" value="{{ defaults.page_size }}" min="1" max="500" />
            </div>
            <div class="col-6">
              <label class="form-label">Recent window (h)</label>
              <input type="number" class="form-control" name="recent_window_hours" value="{{ defaults.recent_window }}" min="1" max="720" />
            </div>
          </div>
          <div class="d-flex align-items-center gap-3 mt-4">
            <button class="btn btn-primary flex-grow-1" type="submit">Refresh</button>
            <div class="spinner-border text-primary loading-indicator" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="card mt-4 shadow-sm border-0">
      <div class="card-body">
        <h6>How it works</h6>
        <ol class="small text-muted ps-3">
          <li>Provide a Google Play package name you own.</li>
          <li>FastAPI backend calls <code>reviews.list</code>/<code>reviews.get</code>.</li>
          <li>Optionally enable AI summarization via OpenAI (see README).</li>
        </ol>
      </div>
    </div>
  </div>

  <div class="col-lg-8">
    <div id="alerts"></div>
    <div class="row g-3">
      <div class="col-sm-6">
        <div class="card card-insight shadow-sm border-0">
          <div class="card-body">
            <div class="text-muted small">Total reviews</div>
            <div class="fs-2 fw-semibold" id="summary-total">0</div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card card-insight shadow-sm border-0">
          <div class="card-body">
            <div class="text-muted small">Average rating</div>
            <div class="fs-2 fw-semibold" id="summary-average">0★</div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card card-insight shadow-sm border-0">
          <div class="card-body">
            <div class="text-muted small">Sentiment split</div>
            <div class="fs-5" id="summary-sentiment">—</div>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card card-insight shadow-sm border-0">
          <div class="card-body">
            <div class="text-muted small">Recent activity</div>
            <div class="fs-5" id="summary-recency">—</div>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm border-0 mt-3 ai-brief-container d-none">
      <div class="card-body">
        <div class="text-muted small mb-2">AI-notes</div>
        <div id="ai-brief" class="ai-brief p-3 rounded">AI summary placeholder</div>
      </div>
    </div>

    <div class="card shadow-sm border-0 mt-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="card-title mb-0">Top keywords</h5>
          <div class="text-muted small">auto extracted</div>
        </div>
        <div id="keywords-list" class="mt-2"></div>
      </div>
    </div>

    <div class="card shadow-sm border-0 mt-3">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Reviews</h5>
          <span class="text-muted small">Powered by <code>reviews.list</code></span>
        </div>
        <div class="table-responsive">
          <table class="table align-middle" id="reviews-table">
            <thead>
              <tr>
                <th>Author</th>
                <th>Rating</th>
                <th>Conversation</th>
                <th>Votes</th>
                <th>Last updated</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
